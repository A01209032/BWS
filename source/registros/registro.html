<!-- Page Content -->
            <div class="container">
              <div class="row">
                <div class="col-lg-12 text-center">

                  <h1 class="mt-5">Registrar servicio <?php echo $_SESSION['departamento']; ?></h1>
                  <ul class="list-unstyled">

                      <div class="row">
              <div class="column">
                <img src="../Images/jesus_tocando_puerta.jpg" style="width:100%">
              </div>
              <div class="column">
                <form method="post" action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']);?>" autocomplete="off" id="form_registros">

                  <br>
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                        Registrar Paciente</button>
                        
                  <br>
                  <br>                  
                  <p id="error">* Datos obligatorios</p>
                  <label for="paciente">Buscar paciente <span id="error"><?php echo $pacienteErr;?><span id="pacienteErr"></span></span></label>
                  <br>
                  <div class="autocomplete">
                    <input class="form-control" type="text" id="paciente" name="paciente" placeholder="" type="" autocomplete="off">
                  </div>
                  <div class="row">
                    <div class="col s6"></div>
                    <div class="col s6">
                      <button type="button" class="btn btn-primary">Modificar paciente</button>
                    </div>
                  </div>
                  <br>
                  <!--<button type="button" class="btn btn-primary" onclick="sendNombreQuery()">Â¡Buscar!</button>-->
                  <br>

                 <!-- Button to Open the Modal -->
                    

                    

                  <label for="asistente">Asistente <span id="error"><?php echo $asistenteErr; ?><span id="asistenteErr"></span></span></label>
                  <br>
                  <div class="autocomplete">
                    <input type="text" id="asistente" name="asistente" placeholder="">
                  </div>
                  <br>
                  <label for="fecha">Fecha <span id="error"><?php echo $fechaError; ?><span id="fechaErr"></span></span></label>
                  <input  type="date" value="<?php echo date('Y-m-d')?>" id="fecha" name="fecha">

                  <label for="tipo">Tipo de Asistencia <span id="error"><?php echo $tipoErr; ?><span id="tipoErr"></span></span></label>
                  <select id="tipo" name="tipo">
                  <?php
                  switch ($_SESSION['departamento']) {
                    case 'asistencias':
                     echo ' <option selected value="domiciliaria">Domiciliaria</option>';
                     echo '<option value="nocturna">Nocturna</option>';
                     echo '<option value="diurna">Diurna</option>';
                     echo '<option value="hospitalaria">Hospitalaria</option>';
                      break;
                    case 'porteria':
                     echo ' <option selected value="Servicio">Servicio</option>';
                     echo '<option value="Alimento">Alimento</option>';
                     echo '<option value="Despensa">Despensa</option>';
                     echo '<option value="Ropa">Ropa</option>';
                      break;
                    case 'dispensario':
                      echo ' <option selected value="Dispensario">Dispensario</option>';
                   
                      break;
                  
                  
                  }
                  
                  
                  
                  ?>
                    
                  </select>

                  <label for="observaciones">Observaciones</label>
                  <input type="text" id="observaciones" name="observaciones">
                  
                  <label for="CuotaRecup">Cuota de Recuperacion</label>
                  <input class="form-control" type="number" value="0" id="CuotaRecup" name="CuotaRecup">
                  <br>
                  <button type="submit" class="btn btn-primary" name="submit">Registrar servicio</button>

                </form>
              </div>
            </div>

          </ul>
        </div>
      </div>
    </div>


  <br>

<!-- The Modal -->
                    <div class="modal" id="myModal">
                      <div class="modal-dialog modal-lg">
                    <div class="modal-content">

                        <!-- Modal Header -->
                         <div class="modal-header">
                           <h1 class="mt-5">Registrar Paciente</h1>
                           <button type="button" class="close" data-dismiss="modal">&times;</button>
                         </div>

                         <!-- Modal body -->
                         <div class="modal-body">
                            <?php
                              include("registro_paciente.html");
                            ?>
                       </div>
                     </div>
                   </div>

<script type="text/javascript" src="autocomplete.js"></script>
<script type="text/javascript">
  window.addEventListener("load", function() {


    var pacientes = {arr: []};

    // Habilitar Ajax a los forms para que todo sea con js
    $('#form_pacientes').on('submit', function(ev) {
      ev.preventDefault();



      $.ajax({
        url: 'registro_paciente.php',
        method: 'POST',
        data: {
          nombre: $('#nombre').val(),
          apellido: $('#apellido').val(),
          enfermedad: $('#enfermedad').val(),
          direccion: $('#direccion').val(),
          telefono: $('#telefono').val(),
          celular: $('#celular').val(),
          fecha_nacimiento: $('#fecha_nacimiento').val(),
          sexo: $('#sexo').val(),
          religion: $('#religion').val(),
          nivel: $('#nivel').val()
        },
        success: function(data) {
          data = JSON.parse(data);
          if(data[0]=="Error: En insercion de base de datos!"){
            alert(data[0]);
            alert(data[1]);
          }
          else if(data[0]=="Success: Al ingresar datos"){
            alert('Se registro exitosamente el paciente');
            $('#nombre').val('');
            $('#fecha_nacimiento').val('');
            $('#apellido').val('');
            $('#direccion').val('');
            $('#telefono').val('');
            $('#celular').val(' ');
            $('#myModal').modal('hide');

            cargarPacientes();
          }
          else{
            $('#nombreErr').html(data[0]);
            $('#nivelErr').html(data[1]);
            $('#apellidoErr').html(data[2]);
            $('#fechaNacimientoErr').html(data[3]);
            $('#enfermedadErr').html(data[4]);
            $('#sexoErr').html(data[5]);
            $('#religionErr').html(data[6]);
            
          }
        },
        dataType: 'text'
      });

      
    });

    // Registro Servicio AJAX
    $('#form_registros').on('submit', function(ev) {
      ev.preventDefault();



      $.ajax({
        url: 'nuevo_registro.php',
        method: 'POST',
        data: {
          paciente: $('#paciente').val(),
          asistente: $('#asistente').val(),
          fecha: $('#fecha').val(),
          tipo: $('#tipo').val(),
          observaciones: $('#observaciones').val(),
          CuotaRecup: $('#CuotaRecup').val(),
          submit: ''
        },
        success: function(data) {
          data = JSON.parse(data);
          if(data[0]=="Error: En insercion de base de datos!"){
            alert(data[0]);
          }
          else if(data[0]=="Success: Al ingresar datos"){
            alert('Se ingresaron los datos');
            $('#paciente').val('');
            $('#asistente').val('');
            $('#fecha').val('');
            $('#tipo').val('');
            $('#observaciones').val('');
            $('#CuotaRecup').val('');
          }
          else{
            $('#pacienteErr').html(data[0]);
            $('#asistenteErr').html(data[1]);
            $('#fechaErr').html(data[2]);
            $('#tipoErr').html(data[3]);
            
          }
        },
        dataType: 'text'
      });

      
    });


    // Cargar Lista de Pacientes
    function cargarPacientes() {
      $.ajax({
        url: "listar_pacientes.php",
        method: 'GET',
        data: {pattern: 'all'},
        type: 'json',
        success: function(data) {
          console.log("Pacientes:" + data);
          data = JSON.parse(data);
          if (data[0] == "Error") {
            alert("There was a critical error on the server!");
            return;
          }
          //console.log(data);
          var nombres = [];
          for (var i=0; i < data.length; i++) {
            //console.log(data[i])
            nombres.push(data[i]['fname']);
          }
          pacientes.arr = nombres;
          autocomplete(document.getElementById('paciente'), pacientes);
        }
      });
    }
    cargarPacientes();


    // Cargar Lista de Voluntarios/Asistentes
    $.ajax({
      url: "listar_asistentes.php",
      method: 'GET',
      data: {pattern: 'all'},
      type: 'json',
      success: function(data) {
        //console.log("Asistentes:" + data);
        data = JSON.parse(data);
        if (data[0] == "Error") {
          alert("There was a critical error on the server!");
          return;
        }
        //console.log(data);
        var nombres = [];
        for (var i=0; i < data.length; i++) {
          //console.log(data[i])
          nombres.push(data[i]['fname']);
        }
        autocomplete(document.getElementById('asistente'), {arr: nombres });
      }
    });

  });
  

  
</script>